<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>U8SDK打包管理系统</title>
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

    <link rel="stylesheet" href="css/xsdk.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="css/ionicons.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="plugins/datatables/dataTables.bootstrap.css">

    <link rel="stylesheet" href="plugins/select2/select2.min.css">
    <link rel="stylesheet" href="plugins/datatables/extensions/Select/css/select.bootstrap.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">

    <link rel="stylesheet" href="plugins/morris/morris.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini" style="background-color: #ecf0f5;">

<div class="row">

    <div class="col-md-3 col-sm-6 col-xs-12">
        <div class="info-box">
            <span class="info-box-icon bg-aqua"><i class="fa fa-life-ring"></i></span>
            <div class="info-box-content">
                <span class="info-box-text" style="font-size: 20px;margin-top: 5px;">昨日新增设备</span>
                <span class="info-box-number" style="font-size: 22px;margin-top: 10px;" id="deviceNum">0</span>
            </div><!-- /.info-box-content -->
        </div><!-- /.info-box -->
    </div><!-- /.col -->
    <div class="col-md-3 col-sm-6 col-xs-12">
        <div class="info-box">
            <span class="info-box-icon bg-green"><i class="fa fa-user"></i></span>
            <div class="info-box-content">
                <span class="info-box-text" style="font-size: 20px;margin-top: 5px;">昨日新增用户</span>
                <span class="info-box-number" style="font-size: 22px;margin-top: 10px;" id="userNum">0</span>
            </div><!-- /.info-box-content -->
        </div><!-- /.info-box -->
    </div><!-- /.col -->
    <div class="col-md-3 col-sm-6 col-xs-12">
        <div class="info-box">
            <span class="info-box-icon bg-yellow"><i class="fa fa-users"></i></span>
            <div class="info-box-content">
                <span class="info-box-text" style="font-size: 20px;margin-top: 5px;">本月新增用户</span>
                <span class="info-box-number" style="font-size: 22px;margin-top: 10px;" id="totalUserNum">0</span>
            </div><!-- /.info-box-content -->
        </div><!-- /.info-box -->
    </div><!-- /.col -->
    <div class="col-md-3 col-sm-6 col-xs-12">
        <div class="info-box">
            <span class="info-box-icon bg-red" ><i class="fa  fa-rmb"></i></span>
            <div class="info-box-content">
                <span class="info-box-text" style="font-size: 20px;margin-top: 5px;">本月总收入(元)</span>
                <span class="info-box-number" style="font-size: 22px;margin-top: 10px;" id="totalMoney">0</span>
            </div><!-- /.info-box-content -->
        </div><!-- /.info-box -->
    </div><!-- /.col -->

</div>

<div class="row">
    <div class="col-md-12">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">过去一周营收情况</h3>

            </div>
            <!-- /.box-header -->
            <div class="box-body">
                <div class="row">
                    <div class="col-md-6">
                        <p class="text-center">
                            <strong id="moneyTitle">收入: </strong>
                        </p>

                        <div class="chart">
                            <!-- Sales Chart Canvas -->
                            <canvas id="salesChart" style="height: 180px;"></canvas>
                        </div>
                        <!-- /.chart-responsive -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-6" id="gameMoneyRank">
                        <p class="text-center">
                            <strong>游戏收入Top 4</strong>
                        </p>

                        <!--<div class="progress-group">-->
                            <!--<span class="progress-text">王者决斗</span>-->
                            <!--<span class="progress-number"><b>100</b>/200</span>-->

                            <!--<div class="progress sm">-->
                                <!--<div class="progress-bar progress-bar-aqua" style="width: 50%"></div>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--&lt;!&ndash; /.progress-group &ndash;&gt;-->
                        <!--<div class="progress-group">-->
                            <!--<span class="progress-text">倚天屠龙记</span>-->
                            <!--<span class="progress-number"><b>50</b>/200</span>-->

                            <!--<div class="progress sm">-->
                                <!--<div class="progress-bar progress-bar-red" style="width: 20%"></div>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--&lt;!&ndash; /.progress-group &ndash;&gt;-->
                        <!--<div class="progress-group">-->
                            <!--<span class="progress-text">天龙八部</span>-->
                            <!--<span class="progress-number"><b>30</b>/200</span>-->

                            <!--<div class="progress sm">-->
                                <!--<div class="progress-bar progress-bar-green" style="width: 13%"></div>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--&lt;!&ndash; /.progress-group &ndash;&gt;-->
                        <!--<div class="progress-group">-->
                            <!--<span class="progress-text">悟空新传</span>-->
                            <!--<span class="progress-number"><b>10</b>/200</span>-->

                            <!--<div class="progress sm">-->
                                <!--<div class="progress-bar progress-bar-yellow" style="width: 5%"></div>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!-- /.progress-group -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </div>
            <!-- ./box-body -->
            <div class="box-footer">
                <div class="row">
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <!--<span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 17%</span>-->
                            <h5 class="description-header" id="moneyNum">¥0</h5>
                            <span class="description-text">7日总收入（元）</span>
                        </div>
                        <!-- /.description-block -->
                    </div>
                    <!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <!--<span class="description-percentage text-yellow"><i class="fa fa-caret-left"></i> 0%</span>-->
                            <h5 class="description-header" id="newUserNum">0</h5>
                            <span class="description-text">7日新增用户数</span>
                        </div>
                        <!-- /.description-block -->
                    </div>
                    <!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <!--<span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 20%</span>-->
                            <h5 class="description-header" id="loginedUserNum">0</h5>
                            <span class="description-text">7日活跃用户数</span>
                        </div>
                        <!-- /.description-block -->
                    </div>
                    <!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block">
                            <!--<span class="description-percentage text-red"><i class="fa fa-caret-down"></i> 18%</span>-->
                            <h5 class="description-header" id="payRatio">0%</h5>
                            <span class="description-text">7日付费率</span>
                        </div>
                        <!-- /.description-block -->
                    </div>
                </div>
                <!-- /.row -->
            </div>
            <!-- /.box-footer -->
        </div>
        <!-- /.box -->
    </div>
    <!-- /.col -->
</div>

<div class="row">

    <div class="col-md-6">

        <!-- solid sales graph -->
        <div class="box box-solid bg-teal-gradient">
            <div class="box-header">
                <i class="fa fa-th"></i>

                <h3 class="box-title">新增用户</h3>

                <!--<div class="box-tools pull-right">-->
                    <!--<button type="button" class="btn bg-teal btn-sm" data-widget="collapse"><i class="fa fa-minus"></i>-->
                    <!--</button>-->
                    <!--<button type="button" class="btn bg-teal btn-sm" data-widget="remove"><i class="fa fa-times"></i>-->
                    <!--</button>-->
                <!--</div>-->
            </div>
            <div class="box-body border-radius-none">
                <div class="chart" id="line-chart" style="height: 250px;"></div>
            </div>
            <!-- /.box-body -->
            <!--<div class="box-footer no-border">-->
                <!--<div class="row">-->
                    <!--<div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">-->
                        <!--<input type="text" class="knob" data-readonly="true" value="50" data-width="60" data-height="60" data-fgColor="#39CCCC">-->

                        <!--<div class="knob-label">倚天屠龙记</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; ./col &ndash;&gt;-->
                    <!--<div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">-->
                        <!--<input type="text" class="knob" data-readonly="true" value="30" data-width="60" data-height="60" data-fgColor="#39CCCC">-->

                        <!--<div class="knob-label">天龙八部</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; ./col &ndash;&gt;-->
                    <!--<div class="col-xs-4 text-center">-->
                        <!--<input type="text" class="knob" data-readonly="true" value="10" data-width="60" data-height="60" data-fgColor="#39CCCC">-->

                        <!--<div class="knob-label">莫拉历险记</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; ./col &ndash;&gt;-->
                <!--</div>-->
                <!--&lt;!&ndash; /.row &ndash;&gt;-->
            <!--</div>-->
            <!-- /.box-footer -->
        </div>
        <!-- /.box -->

    </div>

    <div class="col-md-6">

        <!-- solid sales graph -->
        <div class="box box-solid bg-teal-gradient">
            <div class="box-header">
                <i class="fa fa-th"></i>

                <h3 class="box-title">活跃用户</h3>

                <!--<div class="box-tools pull-right">-->
                    <!--<button type="button" class="btn bg-teal btn-sm" data-widget="collapse"><i class="fa fa-minus"></i>-->
                    <!--</button>-->
                    <!--<button type="button" class="btn bg-teal btn-sm" data-widget="remove"><i class="fa fa-times"></i>-->
                    <!--</button>-->
                <!--</div>-->
            </div>
            <div class="box-body border-radius-none">
                <div class="chart" id="line-chart2" style="height: 250px;"></div>
            </div>
            <!-- /.box-body -->
            <!--<div class="box-footer no-border">-->
                <!--<div class="row">-->
                    <!--<div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">-->
                        <!--<input type="text" class="knob" data-readonly="true" value="50" data-width="60" data-height="60" data-fgColor="#39CCCC">-->

                        <!--<div class="knob-label">天天斗地主</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; ./col &ndash;&gt;-->
                    <!--<div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">-->
                        <!--<input type="text" class="knob" data-readonly="true" value="30" data-width="60" data-height="60" data-fgColor="#39CCCC">-->

                        <!--<div class="knob-label">我爱消消乐</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; ./col &ndash;&gt;-->
                    <!--<div class="col-xs-4 text-center">-->
                        <!--<input type="text" class="knob" data-readonly="true" value="10" data-width="60" data-height="60" data-fgColor="#39CCCC">-->

                        <!--<div class="knob-label">欢乐斗牛</div>-->
                    <!--</div>-->
                    <!--&lt;!&ndash; ./col &ndash;&gt;-->
                <!--</div>-->
                <!--&lt;!&ndash; /.row &ndash;&gt;-->
            <!--</div>-->
            <!-- /.box-footer -->
        </div>
        <!-- /.box -->

    </div>





</div>


<!-- jQuery 2.2.3 -->
<script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- DataTables -->
<script src="plugins/datatables/jquery.dataTables.min.js"></script>
<script src="plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="plugins/select2/select2.min.js"></script>
<script src="plugins/datatables/extensions/Select/js/dataTables.select.js"></script>
<!-- SlimScroll -->
<script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>

<script src="js/xsdk.js"></script>
<script src="js/jquery.form.min.js"></script>
<!-- FastClick -->
<!--<script src="plugins/fastclick/fastclick.js"></script>-->
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!--&lt;!&ndash; AdminLTE for demo purposes &ndash;&gt;-->
<!--<script src="../../dist/js/demo.js"></script>-->
<!-- page script -->
<script src="plugins/jQuery/jquery.md5.js"></script>

<script src="plugins/chartjs/Chart.min.js"></script>
<script src="js/raphael-min.js"></script>
<script src="plugins/morris/morris.min.js"></script>
<script src="plugins/knob/jquery.knob.js"></script>

<script>

    function refreshSummary(result){

        var summary = result.summary;
        var monthSummary = result.monthSummary;

        $("#deviceNum").html(summary.deviceNum);
        $("#userNum").html(summary.userNum);
        $("#totalUserNum").html(monthSummary.userNum);
        $("#totalMoney").html(Math.floor(monthSummary.money / 100));

    }

    function refreshMoneyChart(result){

        var weekData = result.weekData;

        var labelVals = new Array();
        var moneyVals = new Array();
        var userVals = new Array();

        var beginDate = "";
        var endDate = "";

        var itemIndex;
        for(itemIndex in weekData){
            var item = weekData[itemIndex];
            labelVals[itemIndex] = item.currTime;
            moneyVals[itemIndex] = Math.floor(item.money / 100);
            userVals[itemIndex] = item.payUserNum;
        }

        if(weekData.length > 0){
            beginDate = weekData[0].currTime;
            endDate = weekData[weekData.length - 1].currTime;
            $("#moneyTitle").html("收入："+beginDate+"~"+endDate);
        }

        var salesChartCanvas = $("#salesChart").get(0).getContext("2d");
        // This will get the first returned node in the jQuery collection.
        var salesChart = new Chart(salesChartCanvas);

        var salesChartData = {
            labels: labelVals,
            datasets: [
                {
                    label: "收入(元)",
                    fillColor: "rgba(60,141,188,0.9)",
                    strokeColor: "rgba(60,141,188,0.8)",
                    pointColor: "#3b8bba",
                    pointStrokeColor: "rgba(60,141,188,1)",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(60,141,188,1)",
                    data: moneyVals
                }
//                ,
//                {
//                    label: "付费用户数",
//                    fillColor: "rgba(60,141,188,0.9)",
//                    strokeColor: "rgba(60,141,188,0.8)",
//                    pointColor: "#3b8bba",
//                    pointStrokeColor: "rgba(60,141,188,1)",
//                    pointHighlightFill: "#fff",
//                    pointHighlightStroke: "rgba(60,141,188,1)",
//                    data: userVals
//                }
            ]
        };

        var salesChartOptions = {
            //Boolean - If we should show the scale at all
            showScale: true,
            //Boolean - Whether grid lines are shown across the chart
            scaleShowGridLines: false,
            //String - Colour of the grid lines
            scaleGridLineColor: "rgba(0,0,0,.05)",
            //Number - Width of the grid lines
            scaleGridLineWidth: 1,
            //Boolean - Whether to show horizontal lines (except X axis)
            scaleShowHorizontalLines: true,
            //Boolean - Whether to show vertical lines (except Y axis)
            scaleShowVerticalLines: true,
            //Boolean - Whether the line is curved between points
            bezierCurve: true,
            //Number - Tension of the bezier curve between points
            bezierCurveTension: 0.3,
            //Boolean - Whether to show a dot for each point
            pointDot: false,
            //Number - Radius of each point dot in pixels
            pointDotRadius: 4,
            //Number - Pixel width of point dot stroke
            pointDotStrokeWidth: 1,
            //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
            pointHitDetectionRadius: 20,
            //Boolean - Whether to show a stroke for datasets
            datasetStroke: true,
            //Number - Pixel width of dataset stroke
            datasetStrokeWidth: 2,
            //Boolean - Whether to fill the dataset with a color
            datasetFill: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%=datasets[i].label%></li><%}%></ul>",
            //Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
            maintainAspectRatio: true,
            //Boolean - whether to make the chart responsive to window resizing
            responsive: true
        };

        //Create the line chart
        salesChart.Line(salesChartData, salesChartOptions);

    }


    function refreshMoneyTop(result){

        var groupSummary = result.groupSummary;
        var moneyRank = result.moneyRank;

        var colors = ['progress-bar-aqua','progress-bar-red','progress-bar-green','progress-bar-yellow'];

        var html = "";
        var index;
        for(index in moneyRank){

            var rank = moneyRank[index];

            var ratio = Math.floor(rank.money / groupSummary.money * 100);

            var color = colors[index];

            html = html + '<div class="progress-group"><span class="progress-text">'+rank.appName+'</span><span class="progress-number"><b>'+Math.floor(rank.money/100)+'</b>/'+Math.floor(groupSummary.money/100)+'</span>';
            html = html + '<div class="progress sm"><div class="progress-bar ' + color + '" style="width: '+ratio+'%"></div></div></div>';


        }

        $("#gameMoneyRank").append(html);

    }

    function refreshGroupInfo(result) {

        var group = result.groupSummary;
        var yestoday = result.summary;

        $("#moneyNum").html("¥"+Math.floor(group.money / 100));
        $("#newUserNum").html(group.userNum);
        $("#loginedUserNum").html(yestoday.loginedUserNum7);

        var totalPayRatio = yestoday.payUserNum7 / yestoday.loginedUserNum7 * 100;

        $("#payRatio").html(totalPayRatio.toFixed(2)+"%");
    }

    function refreshUserChart(result, type){

        var weekData = result.weekData;


        var dataArray = new Array();

        var itemIndex;
        for(itemIndex in weekData){
            var item = weekData[itemIndex];
            var obj = new Object();
            obj.y = item.currTime;
            if(type == 1){
                obj.item1 = item.userNum;           //新增用户数量
            }else if(type == 2){
                obj.item1 = item.loginedUserNum;    //活跃用户数数量
            }

            dataArray[itemIndex] = obj;
        }

        var selector = "line-chart";
        if(type == 2){
            selector = "line-chart2";
        }

        var line = new Morris.Line({
            element: selector,
            resize: true,
            data: dataArray,
            xkey: 'y',
            ykeys: ['item1'],
            labels: ['数量'],
            lineColors: ['#efefef'],
            lineWidth: 2,
            hideHover: 'auto',
            gridTextColor: "#fff",
            gridStrokeWidth: 0.4,
            pointSize: 4,
            pointStrokeColors: ["#efefef"],
            gridLineColor: "#efefef",
            gridTextFamily: "Open Sans",
            gridTextSize: 10
        });

        $('.box ul.nav a').on('shown.bs.tab', function () {
            line.redraw();
        });
    }



    function refreshData(){

        $.post('admin/analytics/getSummaryData',{}, function (result) {

            if(result.code == 0){

                refreshSummary(result);
                refreshMoneyChart(result);
                refreshMoneyTop(result);
                refreshGroupInfo(result);
                refreshUserChart(result, 1);
                refreshUserChart(result, 2);

            }else if(result.code == 2){
                parent.location.href = "login.html";
            }

        },'json');

    }

    //页面加载初始化执行逻辑
    $(function () {

        refreshData();
//        $(".knob").knob();

    });




</script>
</body>
</html>
